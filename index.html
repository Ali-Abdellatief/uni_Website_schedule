<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Schedule</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3dc;
            --light-color: #e9f1f7;
            --dark-color: #333333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            
            /* Theme specific variables */
            --bg-color: #f5f7fa;
            --container-bg: #ffffff;
            --text-color: #333333;
            --border-color: #ddd;
            --card-bg: #ffffff;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --header-text: #4a6fa5;
            --calendar-other-month: #f5f5f5;
            --calendar-other-month-text: #999;
        }
        
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --container-bg: #2d2d2d;
            --text-color: #e1e1e1;
            --border-color: #404040;
            --card-bg: #363636;
            --card-shadow: rgba(0, 0, 0, 0.3);
            --header-text: #6a8fc5;
            --calendar-other-month: #262626;
            --calendar-other-month-text: #666;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: a1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--container-bg);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--header-text);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        h2 {
            color: var(--secondary-color);
            font-size: 1.8rem;
            margin: 25px 0 15px 0;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
        }
        
        .course-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .course-table th {
            background-color: var(--primary-color);
            color: white;
            text-align: left;
            padding: 12px 15px;
        }
        
        .course-table tr:nth-child(even) {
            background-color: var(--light-color);
        }
        
        .course-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .emoji {
            font-size: 1.3rem;
            margin-right: 5px;
        }
        
        .weekly-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .day-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 6px var(--card-shadow);
            padding: 15px;
            transition: transform 0.3s ease;
        }
        
        .day-card:hover {
            transform: translateY(-5px);
        }
        
        .day-card h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .day-card ul {
            list-style-type: none;
        }
        
        .day-card li {
            padding: 8px 0;
            border-bottom: 1px dotted #ddd;
        }
        
        .free-day {
            background-color: #e8f5e9;
            border-left: 4px solid var(--success-color);
        }
        
        .benefits {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .benefits ul {
            list-style-type: none;
            padding-left: 20px;
        }
        
        .benefits li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 25px;
        }
        
        .benefits li:before {
            content: "✨";
            position: absolute;
            left: 0;
            color: var(--accent-color);
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a5a84;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #bd2130;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.9rem;
        }

        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-content {
            background-color: var(--container-bg);
            margin: auto;
            padding: 25px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
            animation: modalSlideIn 0.3s ease;
            color: var(--text-color);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
            z-index: 2;
        }

        .close:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
            outline: none;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .hide {
            display: none;
        }
        
        @media (max-width: 768px) {
            .weekly-overview {
                grid-template-columns: 1fr;
            }
            
            .course-table {
                font-size: 0.9rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
                margin: 10px auto;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-control {
                padding: 10px;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }

        @media (max-height: 800px) {
            .modal-content {
                max-height: 85vh;
            }
        }

        .calendar-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 30px;
        }

        .calendar-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .calendar-day {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            min-height: 100px;
            padding: 10px;
            position: relative;
        }

        .calendar-day.other-month {
            background-color: var(--calendar-other-month);
            color: var(--calendar-other-month-text);
        }

        .calendar-day .date {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .calendar-day .course-item {
            font-size: 0.8rem;
            margin: 20px 0 5px 0;
            padding: 5px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .timeline-section {
            margin: 40px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .timeline-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .zoom-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .timeline-container {
            position: relative;
            overflow-x: auto;
            padding: 20px 0;
        }

        .timeline {
            position: relative;
            min-height: 150px;
            transition: all 0.3s ease;
        }

        .timeline-scale {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            border-bottom: 2px solid var(--primary-color);
        }

        .timeline-events {
            position: relative;
            margin-top: 40px;
        }

        .timeline-event {
            position: absolute;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
            z-index: 1;
        }

        .timeline-event:hover {
            transform: translateY(-2px);
            z-index: 2;
        }

        .timeline-marker {
            position: absolute;
            width: 2px;
            height: 10px;
            background-color: var(--primary-color);
            bottom: -10px;
        }

        .timeline-date {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: var(--dark-color);
        }

        .zoom-level {
            padding: 5px 10px;
            border-radius: 4px;
            background-color: var(--light-color);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .zoom-level.active {
            background-color: var(--primary-color);
            color: white;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--container-bg);
            box-shadow: 0 2px 5px var(--card-shadow);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .assignments-section {
            margin: 40px 0;
            padding: 20px;
            background-color: var(--container-bg);
            border-radius: 10px;
            box-shadow: 0 0 20px var(--card-shadow);
        }

        .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .assignment-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background-color: var(--light-color);
            color: var(--text-color);
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .assignment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .assignment-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px var(--card-shadow);
            transition: transform 0.3s ease;
            border-left: 4px solid transparent;
        }

        .assignment-card:hover {
            transform: translateY(-5px);
        }

        .assignment-card.not-started {
            border-left-color: var(--warning-color);
        }

        .assignment-card.in-progress {
            border-left-color: var(--primary-color);
        }

        .assignment-card.completed {
            border-left-color: var(--success-color);
        }

        .assignment-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .assignment-course {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-bottom: 8px;
        }

        .assignment-deadline {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .countdown {
            font-size: 0.8rem;
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--light-color);
            border-radius: 3px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .assignment-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-badge.not-started {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .status-badge.in-progress {
            background-color: var(--primary-color);
            color: white;
        }

        .status-badge.completed {
            background-color: var(--success-color);
            color: white;
        }

        .assignment-modal .form-group {
            margin-bottom: 15px;
        }

        .assignment-modal textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Pomodoro Timer Styles */
        .pomodoro-section {
            margin: 40px 0;
            padding: 20px;
            background-color: var(--container-bg);
            border-radius: 10px;
            box-shadow: 0 0 20px var(--card-shadow);
        }

        .pomodoro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .timer-controls select {
            min-width: 200px;
        }

        .timer-display {
            text-align: center;
            position: relative;
            margin: 40px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-remaining {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-family: monospace;
        }

        .timer-phase {
            font-size: 1.2rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .progress-ring {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .progress-ring-circle {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.3s;
        }

        .progress-ring-circle-bg {
            fill: none;
            stroke: var(--light-color);
            stroke-width: 8;
        }

        .session-stats {
            margin-top: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-course {
            font-weight: bold;
            color: var(--text-color);
        }

        .stat-sessions {
            color: var(--secondary-color);
            margin-top: 5px;
        }

        .stat-time {
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .timer-settings {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-item label {
            font-weight: bold;
            color: var(--secondary-color);
        }

        .setting-item input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">☀️</button>
    <div class="container">
        <header>
            <h1>MY ACADEMIC SCHEDULE</h1>
            <p>Spring Term</p>
            <p style="font-style: italic; text-decoration: underline; margin-top: 5px;">Made by Ali Abdellatief</p>
        </header>
        
        <section>
            <h2>📚 COURSES</h2>
            <div style="margin-bottom: 15px;">
                <button id="addCourseBtn" class="btn btn-primary">Add New Course</button>
                <button id="exportPdfBtn" class="btn btn-primary">Export to PDF</button>
            </div>
            <table class="course-table" id="courseTable">
                <thead>
                    <tr>
                        <th>Course</th>
                        <th>Code</th>
                        <th>Sessions (Week Numbers)</th>
                        <th>Time</th>
                        <th>Room</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table content will be populated by JavaScript -->
                </tbody>
            </table>
        </section>
        
        <section>
            <h2>📅 WEEKLY OVERVIEW</h2>
            <div class="weekly-overview" id="weeklyOverview">
                <!-- Day cards will be populated by JavaScript -->
            </div>
        </section>
        
        <section class="benefits">
            <h2>✨ SCHEDULE BENEFITS</h2>
            <ul>
                <li><strong>Tuesday & Friday:</strong> Full days off</li>
                <li><strong>No Conflicts:</strong> Alternating Monday morning classes</li>
                <li><strong>Afternoons Free:</strong> Except for Software Engineering</li>
                <li><strong>4-Day Weekends:</strong> Friday through Monday (mostly)</li>
            </ul>
        </section>
    </section>

    <section class="pomodoro-section">
        <div class="pomodoro-header">
            <h2>⏱️ POMODORO TIMER</h2>
            <div class="timer-controls">
                <select id="courseSelect" class="form-control">
                    <option value="">Select Course</option>
                </select>
                <button id="startTimer" class="btn btn-primary">Start</button>
                <button id="pauseTimer" class="btn btn-warning" disabled>Pause</button>
                <button id="resetTimer" class="btn btn-danger" disabled>Reset</button>
            </div>
        </div>
        <div class="timer-display">
            <div class="time-remaining">
                <span id="minutes">25</span>:<span id="seconds">00</span>
            </div>
            <div class="timer-phase">Work Time</div>
            <div class="progress-ring">
                <svg width="200" height="200">
                    <circle class="progress-ring-circle-bg" cx="100" cy="100" r="90" />
                    <circle class="progress-ring-circle" cx="100" cy="100" r="90" />
                </svg>
            </div>
        </div>
        <div class="session-stats">
            <h3>Today's Focus Sessions</h3>
            <div id="focusStats" class="stats-grid">
                <!-- Stats will be populated by JavaScript -->
            </div>
        </div>
        <div class="timer-settings">
            <h3>Timer Settings</h3>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="workDuration">Work Duration (min)</label>
                    <input type="number" id="workDuration" value="25" min="1" max="60">
                </div>
                <div class="setting-item">
                    <label for="shortBreak">Short Break (min)</label>
                    <input type="number" id="shortBreak" value="5" min="1" max="30">
                </div>
                <div class="setting-item">
                    <label for="longBreak">Long Break (min)</label>
                    <input type="number" id="longBreak" value="15" min="1" max="45">
                </div>
                <div class="setting-item">
                    <label for="sessionsBeforeLongBreak">Sessions before Long Break</label>
                    <input type="number" id="sessionsBeforeLongBreak" value="4" min="1" max="8">
                </div>
            </div>
        </div>
    </section>

    <section>
        <h2>📆 MONTHLY CALENDAR</h2>
        <div class="calendar-controls">
            <button class="btn btn-primary" id="prevMonth">←</button>
            <h3 id="currentMonth">April 2024</h3>
            <button class="btn btn-primary" id="nextMonth">→</button>
        </div>
        <div class="calendar" id="calendar"></div>
    </section>

    <section class="timeline-section">
        <h2>📅 SEMESTER TIMELINE</h2>
        <div class="timeline-controls">
            <div class="zoom-controls">
                <span>Zoom:</span>
                <button class="btn btn-sm zoom-level" data-zoom="day">Day</button>
                <button class="btn btn-sm zoom-level active" data-zoom="week">Week</button>
                <button class="btn btn-sm zoom-level" data-zoom="month">Month</button>
            </div>
            <div class="navigation-controls">
                <button class="btn btn-primary btn-sm" id="prevTimeline">←</button>
                <button class="btn btn-primary btn-sm" id="nextTimeline">→</button>
            </div>
        </div>
        <div class="timeline-container">
            <div class="timeline">
                <div class="timeline-scale"></div>
                <div class="timeline-events"></div>
            </div>
        </div>
    </section>

    <section class="assignments-section">
        <div class="assignment-header">
            <h2>📝 ASSIGNMENTS</h2>
            <button id="addAssignmentBtn" class="btn btn-primary">Add Assignment</button>
        </div>
        <div class="assignment-filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="not-started">Not Started</button>
            <button class="filter-btn" data-filter="in-progress">In Progress</button>
            <button class="filter-btn" data-filter="completed">Completed</button>
        </div>
        <div class="assignment-grid" id="assignmentGrid">
            <!-- Assignment cards will be populated by JavaScript -->
        </div>
    </section>

    <!-- Add/Edit Course Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Add New Course</h2>
            <form id="courseForm">
                <input type="hidden" id="courseId">
                <div class="form-group">
                    <label for="courseName">Course Name:</label>
                    <input type="text" id="courseName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="courseEmoji">Course Emoji:</label>
                    <input type="text" id="courseEmoji" class="form-control" placeholder="e.g. 🧠, 📊, 💻">
                </div>
                <div class="form-group">
                    <label for="courseCode">Course Code:</label>
                    <input type="text" id="courseCode" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="courseSessions">Sessions (Week Numbers):</label>
                    <input type="text" id="courseSessions" class="form-control" placeholder="e.g. 20 24 26" required>
                </div>
                <div class="form-group">
                    <label for="courseTime">Time:</label>
                    <input type="text" id="courseTime" class="form-control" placeholder="e.g. 12:10" required>
                </div>
                <div class="form-group">
                    <label for="courseDays">Day of Week:</label>
                    <select id="courseDays" class="form-control" required>
                        <option value="">Select a day</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                        <option value="Sunday">Sunday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="courseDayTime">Day Time:</label>
                    <select id="courseDayTime" class="form-control" required>
                        <option value="">Select time of day</option>
                        <option value="Morning">Morning</option>
                        <option value="Afternoon">Afternoon</option>
                        <option value="Evening">Evening</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="courseRoom">Room Number:</label>
                    <input type="text" id="courseRoom" class="form-control" placeholder="e.g. Room 301" required>
                </div>
                <div class="form-group">
                    <label for="courseColor">Course Color:</label>
                    <input type="color" id="courseColor" class="form-control" value="#4a6fa5">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Course</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Assignment Modal -->
    <div id="assignmentModal" class="modal assignment-modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="assignmentModalTitle">Add New Assignment</h2>
            <form id="assignmentForm">
                <input type="hidden" id="assignmentId">
                <div class="form-group">
                    <label for="assignmentTitle">Title:</label>
                    <input type="text" id="assignmentTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="assignmentCourse">Course:</label>
                    <select id="assignmentCourse" class="form-control" required>
                        <!-- Options will be populated from courses -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignmentDescription">Description:</label>
                    <textarea id="assignmentDescription" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label for="assignmentDeadline">Deadline:</label>
                    <input type="datetime-local" id="assignmentDeadline" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="assignmentProgress">Progress (%):</label>
                    <input type="number" id="assignmentProgress" class="form-control" min="0" max="100" value="0">
                </div>
                <div class="form-group">
                    <label for="assignmentStatus">Status:</label>
                    <select id="assignmentStatus" class="form-control" required>
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="cancelAssignmentBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Assignment</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Sample initial data
        let courses = [
            { id: 1, name: "Algorithms", emoji: "🧠", code: "IE3-ADL/02", sessions: "20,24,26", time: "12:10", day: "Monday", dayTime: "Morning", color: "#FFF000", room: "Room 1360" },
            { id: 2, name: "Digital Signal Processing", emoji: "📊", code: "IE6-DPL/02", sessions: "22, 25, 28", time: "12:10", day: "Monday", dayTime: "Morning", color: "#006400", room: "Room 0885" },
            { id: 3, name: "Software Engineering", emoji: "💻", code: "IE4-SEL1/01/02", sessions: "18, 20, 22, 24, 26, 28", time: "17:40", day: "Monday", dayTime: "Evening", color: "#006400", room: "Room 0565" },
            { id: 4, name: "Digital Communication Systems", emoji: "📡", code: "IE6-DCL/01", sessions: "20 ,24 ,27", time: "12:10", day: "Wednesday", dayTime: "Morning" , color: "#FF0000", room: "Room 1485"},
            { id: 5, name: "Operating Systems", emoji: "🖥️", code: "IE6-OSL/01", sessions: "21 ,25 ,28", time: "12:10", day: "Thursday", dayTime: "Morning" , color: "#5B0000", room: "Room 0880"}
        ];
        
        // Days of the week data
        const days = [
            { name: "Monday", free: false, emoji: "📅" },
            { name: "Tuesday", free: true, emoji: "🏖️" },
            { name: "Wednesday", free: false, emoji: "📅" },
            { name: "Thursday", free: false, emoji: "📅" },
            { name: "Friday", free: true, emoji: "🏖️" },
            { name: "Weekend", free: true, emoji: "🏖️" }
        ];
        
        // DOM Elements
        const courseTable = document.getElementById('courseTable');
        const weeklyOverview = document.getElementById('weeklyOverview');
        const addCourseBtn = document.getElementById('addCourseBtn');
        const courseModal = document.getElementById('courseModal');
        const modalTitle = document.getElementById('modalTitle');
        const courseForm = document.getElementById('courseForm');
        const courseIdInput = document.getElementById('courseId');
        const courseNameInput = document.getElementById('courseName');
        const courseEmojiInput = document.getElementById('courseEmoji');
        const courseCodeInput = document.getElementById('courseCode');
        const courseSessionsInput = document.getElementById('courseSessions');
        const courseTimeInput = document.getElementById('courseTime');
        const courseDaysInput = document.getElementById('courseDays');
        const courseDayTimeInput = document.getElementById('courseDayTime');
        const cancelBtn = document.getElementById('cancelBtn');
        const closeModalBtn = document.querySelector('.close');
        
        // Add months array at the top of your script
        const months = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        // Helper function to format date as YYYY-MM-DD
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        // Helper function to parse date string
        function parseDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(num => parseInt(num));
            return new Date(year, month - 1, day);
        }

        // Function to convert user-friendly date to ISO format
        function convertToISODate(dateStr) {
            const currentYear = new Date().getFullYear();
            const months = {
                'January': '01', 'February': '02', 'March': '03', 'April': '04',
                'May': '05', 'June': '06', 'July': '07', 'August': '08',
                'September': '09', 'October': '10', 'November': '11', 'December': '12'
            };
            
            // Handle different date formats
            dateStr = dateStr.trim();
            
            // If already in YYYY-MM-DD format
            if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
                return dateStr;
            }
            
            // Handle "Month Day" format (e.g., "April 20")
            const parts = dateStr.split(' ');
            if (parts.length === 2) {
                const month = months[parts[0]];
                const day = parts[1].padStart(2, '0');
                if (month) {
                    return `${currentYear}-${month}-${day}`;
                }
            }
            
            // Handle "Month Day, Year" format
            const match = dateStr.match(/(\w+)\s+(\d+)(?:,\s*(\d{4}))?/);
            if (match) {
                const month = months[match[1]];
                const day = match[2].padStart(2, '0');
                const year = match[3] || currentYear;
                if (month) {
                    return `${year}-${month}-${day}`;
                }
            }
            
            return dateStr;
        }

        // Pomodoro Timer functionality
        let timerState = {
            isRunning: false,
            timeRemaining: 25 * 60, // 25 minutes in seconds
            currentPhase: 'work', // 'work', 'shortBreak', 'longBreak'
            completedSessions: 0,
            selectedCourse: null,
            interval: null
        };

        let focusStats = {};

        // Load focus stats from localStorage
        function loadFocusStats() {
            const savedStats = localStorage.getItem('focusStats');
            if (savedStats) {
                focusStats = JSON.parse(savedStats);
            }
        }

        // Save focus stats to localStorage
        function saveFocusStats() {
            localStorage.setItem('focusStats', JSON.stringify(focusStats));
        }

        // Update the timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timerState.timeRemaining / 60);
            const seconds = timerState.timeRemaining % 60;
            
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
            
            // Update progress ring
            const circle = document.querySelector('.progress-ring-circle');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            
            let totalTime;
            switch(timerState.currentPhase) {
                case 'work':
                    totalTime = parseInt(document.getElementById('workDuration').value) * 60;
                    break;
                case 'shortBreak':
                    totalTime = parseInt(document.getElementById('shortBreak').value) * 60;
                    break;
                case 'longBreak':
                    totalTime = parseInt(document.getElementById('longBreak').value) * 60;
                    break;
            }
            
            const progress = timerState.timeRemaining / totalTime;
            const offset = circumference - (progress * circumference);
            circle.style.strokeDashoffset = offset;
        }

        // Start the timer
        function startTimer() {
            if (!timerState.selectedCourse) {
                alert('Please select a course first!');
                return;
            }

            timerState.isRunning = true;
            document.getElementById('startTimer').disabled = true;
            document.getElementById('pauseTimer').disabled = false;
            document.getElementById('resetTimer').disabled = false;
            document.getElementById('courseSelect').disabled = true;

            timerState.interval = setInterval(() => {
                timerState.timeRemaining--;
                updateTimerDisplay();

                if (timerState.timeRemaining <= 0) {
                    handleTimerComplete();
                }
            }, 1000);
        }

        // Pause the timer
        function pauseTimer() {
            timerState.isRunning = false;
            clearInterval(timerState.interval);
            document.getElementById('startTimer').disabled = false;
            document.getElementById('pauseTimer').disabled = true;
        }

        // Reset the timer
        function resetTimer() {
            timerState.isRunning = false;
            clearInterval(timerState.interval);
            
            const workDuration = parseInt(document.getElementById('workDuration').value);
            timerState.timeRemaining = workDuration * 60;
            timerState.currentPhase = 'work';
            
            document.getElementById('startTimer').disabled = false;
            document.getElementById('pauseTimer').disabled = true;
            document.getElementById('resetTimer').disabled = true;
            document.getElementById('courseSelect').disabled = false;
            
            updateTimerDisplay();
            document.querySelector('.timer-phase').textContent = 'Work Time';
        }

        // Handle timer completion
        function handleTimerComplete() {
            clearInterval(timerState.interval);
            
            if (timerState.currentPhase === 'work') {
                // Update focus stats
                const today = new Date().toLocaleDateString();
                if (!focusStats[today]) {
                    focusStats[today] = {};
                }
                if (!focusStats[today][timerState.selectedCourse]) {
                    focusStats[today][timerState.selectedCourse] = {
                        sessions: 0,
                        minutes: 0
                    };
                }
                
                focusStats[today][timerState.selectedCourse].sessions++;
                focusStats[today][timerState.selectedCourse].minutes += parseInt(document.getElementById('workDuration').value);
                saveFocusStats();
                renderFocusStats();

                timerState.completedSessions++;
                
                // Determine next break type
                const sessionsBeforeLongBreak = parseInt(document.getElementById('sessionsBeforeLongBreak').value);
                if (timerState.completedSessions % sessionsBeforeLongBreak === 0) {
                    timerState.currentPhase = 'longBreak';
                    timerState.timeRemaining = parseInt(document.getElementById('longBreak').value) * 60;
                    document.querySelector('.timer-phase').textContent = 'Long Break';
                } else {
                    timerState.currentPhase = 'shortBreak';
                    timerState.timeRemaining = parseInt(document.getElementById('shortBreak').value) * 60;
                    document.querySelector('.timer-phase').textContent = 'Short Break';
                }
            } else {
                // Break is over, start new work session
                timerState.currentPhase = 'work';
                timerState.timeRemaining = parseInt(document.getElementById('workDuration').value) * 60;
                document.querySelector('.timer-phase').textContent = 'Work Time';
            }
            
            // Play notification sound
            const audio = new Audio('data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=');
            audio.play();
            
            updateTimerDisplay();
            startTimer();
        }

        // Render focus stats
        function renderFocusStats() {
            const statsGrid = document.getElementById('focusStats');
            statsGrid.innerHTML = '';
            
            const today = new Date().toLocaleDateString();
            const todayStats = focusStats[today] || {};
            
            Object.entries(todayStats).forEach(([courseId, stats]) => {
                const course = courses.find(c => c.id === parseInt(courseId));
                if (!course) return;
                
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <div class="stat-info">
                        <span class="stat-course">${course.emoji} ${course.name}</span>
                        <span class="stat-sessions">${stats.sessions} sessions</span>
                    </div>
                    <div class="stat-time">${stats.minutes} min</div>
                `;
                statsGrid.appendChild(statCard);
            });
        }

        // Initialize Pomodoro timer
        function initPomodoro() {
            // Populate course select
            const courseSelect = document.getElementById('courseSelect');
            courseSelect.innerHTML = '<option value="">Select Course</option>' +
                courses.map(course => `<option value="${course.id}">${course.emoji} ${course.name}</option>`).join('');
            
            // Add event listeners
            document.getElementById('startTimer').addEventListener('click', startTimer);
            document.getElementById('pauseTimer').addEventListener('click', pauseTimer);
            document.getElementById('resetTimer').addEventListener('click', resetTimer);
            
            courseSelect.addEventListener('change', (e) => {
                timerState.selectedCourse = e.target.value;
            });
            
            // Load and render focus stats
            loadFocusStats();
            renderFocusStats();
            
            // Initialize progress ring
            const circle = document.querySelector('.progress-ring-circle');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = circumference;
        }

        // Initialize the application
        function init() {
            // Initialize theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            // Load courses from localStorage on startup
            const savedCourses = localStorage.getItem('courses');
            if (savedCourses) {
                courses = JSON.parse(savedCourses);
                console.log('Loaded courses from localStorage:', courses);
            } else {
                console.log('Using initial courses data:', courses);
            }
            
            renderCourseTable();
            renderWeeklyOverview();
            renderCalendar();
            renderTimeline();
            initAssignments();
            initPomodoro(); // Initialize Pomodoro timer
            setupEventListeners();
        }
        
        // Render course table
        function renderCourseTable() {
            const tbody = courseTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            courses.forEach(course => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="background-color: ${course.color}20"><span class="emoji">${course.emoji}</span> ${course.name}</td>
                    <td style="background-color: ${course.color}20">${course.code}</td>
                    <td style="background-color: ${course.color}20">${course.sessions}</td>
                    <td style="background-color: ${course.color}20">${course.time}</td>
                    <td style="background-color: ${course.color}20">${course.room || 'N/A'}</td>
                    <td class="action-buttons">
                        <button type="button" class="btn btn-warning btn-sm edit-course" data-id="${course.id}">Edit</button>
                        <button type="button" class="btn btn-danger btn-sm delete-course" data-id="${course.id}">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Render weekly overview
        function renderWeeklyOverview() {
            weeklyOverview.innerHTML = '';
            
            days.forEach(day => {
                const dayCard = document.createElement('div');
                dayCard.className = `day-card ${day.free ? 'free-day' : ''}`;
                
                const dayCourses = courses.filter(course => {
                    if (day.name === 'Weekend') {
                        return course.day === 'Saturday' || course.day === 'Sunday';
                    }
                    return course.day === day.name;
                });
                
                let coursesList = '';
                if (dayCourses.length > 0) {
                    coursesList = '<ul>';
                    dayCourses.forEach(course => {
                        coursesList += `<li>${course.dayTime}: ${course.emoji} ${course.name} (${course.time})</li>`;
                    });
                    coursesList += '</ul>';
                } else if (day.free) {
                    coursesList = '<p>🏖️ FREE DAY</p>';
                } else {
                    coursesList = '<p>No classes scheduled</p>';
                }
                
                dayCard.innerHTML = `
                    <h3>${day.name} <span class="emoji">${day.emoji}</span></h3>
                    ${coursesList}
                `;
                
                weeklyOverview.appendChild(dayCard);
            });
        }
        
        // Open modal to add a new course
        function openAddCourseModal() {
            modalTitle.textContent = 'Add New Course';
            courseForm.reset();
            courseIdInput.value = '';
            courseModal.style.display = 'block';
        }
        
        // Open modal to edit an existing course
        function openEditCourseModal(courseId) {
            console.log('Opening edit modal for course:', courseId);
            const course = courses.find(c => c.id === courseId);
            if (!course) {
                console.error('Course not found:', courseId);
                return;
            }
            
            // Reset form and set values
            courseForm.reset();
            modalTitle.textContent = 'Edit Course';
            courseIdInput.value = course.id;
            courseNameInput.value = course.name;
            courseEmojiInput.value = course.emoji;
            courseCodeInput.value = course.code;
            courseSessionsInput.value = course.sessions;
            courseTimeInput.value = course.time;
            courseDaysInput.value = course.day;
            courseDayTimeInput.value = course.dayTime;
            document.getElementById('courseRoom').value = course.room || '';
            document.getElementById('courseColor').value = course.color || '#4a6fa5';
            
            // Show modal
            courseModal.style.display = 'block';
            
            console.log('Modal opened with course data:', course);
        }
        
        // Close the modal
        function closeModal() {
            courseModal.style.display = 'none';
        }
        
        // Save course (add new or update existing)
        function saveCourse(e) {
            e.preventDefault();
            
            const courseId = courseIdInput.value ? parseInt(courseIdInput.value) : null;
            
            // Store sessions as simple space-separated numbers
            const sessionsArray = courseSessionsInput.value
                .split(/[,\s]+/)  // Split by commas or spaces
                .map(num => num.trim())
                .filter(num => num)  // Remove empty strings
                .sort((a, b) => parseInt(a) - parseInt(b))  // Sort numerically
                .join(' ');

            const newCourse = {
                name: courseNameInput.value,
                emoji: courseEmojiInput.value || '📚',
                code: courseCodeInput.value,
                sessions: sessionsArray,
                time: courseTimeInput.value,
                day: courseDaysInput.value,
                dayTime: courseDayTimeInput.value,
                room: document.getElementById('courseRoom').value,
                color: document.getElementById('courseColor').value || '#4a6fa5'
            };
            
            if (courseId) {
                // Update existing course
                const index = courses.findIndex(c => c.id === courseId);
                if (index !== -1) {
                    courses[index] = { ...courses[index], ...newCourse, id: courseId };
                }
            } else {
                // Add new course
                const maxId = courses.length > 0 ? Math.max(...courses.map(c => c.id)) : 0;
                courses.push({ ...newCourse, id: maxId + 1 });
            }
            
            // Save to localStorage
            localStorage.setItem('courses', JSON.stringify(courses));
            
            // Re-render UI and close modal
            renderCourseTable();
            renderWeeklyOverview();
            renderCalendar();
            renderTimeline();
            closeModal();
        }
        
        // Delete a course
        function deleteCourse(courseId) {
            if (confirm('Are you sure you want to delete this course?')) {
                courses = courses.filter(c => c.id !== courseId);
                // Save to localStorage after deletion
                localStorage.setItem('courses', JSON.stringify(courses));
                renderCourseTable();
                renderWeeklyOverview();
                renderCalendar();
                renderTimeline();
            }
        }

        let currentDate = new Date();

        // Helper function to get week number from date
        function getWeekNumber(date) {
            const start = new Date(date.getFullYear(), 0, 1);
            const days = Math.floor((date - start) / (24 * 60 * 60 * 1000));
            return Math.ceil((days + start.getDay() + 1) / 7);
        }

        // Helper function to get month from week number
        function getMonthFromWeek(weekNumber) {
            const semesterStart = new Date(2024, 3, 1); // April 1, 2024
            const weekStart = new Date(semesterStart);
            weekStart.setDate(semesterStart.getDate() + (weekNumber - 17) * 7); // Week 17 starts April 1
            
            return weekStart.getMonth();
        }

        // Helper function to get year from week number
        function getYearFromWeek(weekNumber) {
            const semesterStart = new Date(2024, 3, 1);
            const weekStart = new Date(semesterStart);
            weekStart.setDate(semesterStart.getDate() + (weekNumber - 17) * 7);
            
            return weekStart.getFullYear();
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const currentMonthElem = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month/year display
            currentMonthElem.textContent = new Intl.DateTimeFormat('en-US', {
                year: 'numeric',
                month: 'long'
            }).format(currentDate);
            
            // Clear calendar
            calendar.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Add padding days from previous month
            for (let i = 0; i < firstDay.getDay(); i++) {
                const paddingDay = document.createElement('div');
                paddingDay.className = 'calendar-day other-month';
                calendar.appendChild(paddingDay);
            }
            
            // Add days of current month
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                // Add date number
                const dateSpan = document.createElement('span');
                dateSpan.className = 'date';
                dateSpan.textContent = day;
                dayDiv.appendChild(dateSpan);
                
                // Format the current date for comparison (YYYY-MM-DD)
                const paddedMonth = String(month + 1).padStart(2, '0');
                const paddedDay = String(day).padStart(2, '0');
                const currentDateStr = `${year}-${paddedMonth}-${paddedDay}`;
                
                // Find courses for this date
                const coursesForDay = courses.filter(course => {
                    if (!course.sessions) return false;
                    const sessionDates = course.sessions.split(',').map(s => s.trim());
                    return sessionDates.some(date => date === currentDateStr);
                });
                
                // Add courses to the day
                if (coursesForDay.length > 0) {
                    const coursesContainer = document.createElement('div');
                    coursesContainer.style.marginTop = '20px';
                    
                    coursesForDay.forEach(course => {
                        const courseDiv = document.createElement('div');
                        courseDiv.className = 'course-item';
                        courseDiv.style.backgroundColor = `${course.color}40`;
                        courseDiv.style.marginBottom = '2px';
                        courseDiv.textContent = `${course.emoji} ${course.name} (${course.time})`;
                        coursesContainer.appendChild(courseDiv);
                    });
                    
                    dayDiv.appendChild(coursesContainer);
                }
                
                calendar.appendChild(dayDiv);
            }
        }

        let currentZoom = 'week';
        let timelineStartDate = new Date(2024, 3, 1); // April 1, 2024
        let timelineEndDate = new Date(2024, 6, 31); // July 31, 2024

        function renderTimeline() {
            const timeline = document.querySelector('.timeline');
            const timelineEvents = document.querySelector('.timeline-events');
            const timelineScale = document.querySelector('.timeline-scale');
            
            // Clear previous content
            timelineEvents.innerHTML = '';
            timelineScale.innerHTML = '';
            
            // Calculate timeline dimensions based on zoom level
            const totalDays = (timelineEndDate - timelineStartDate) / (1000 * 60 * 60 * 24);
            let dayWidth;
            
            switch(currentZoom) {
                case 'day':
                    dayWidth = 50; // 50px per day
                    break;
                case 'week':
                    dayWidth = 20; // 20px per day
                    break;
                case 'month':
                    dayWidth = 8; // 8px per day
                    break;
            }
            
            const timelineWidth = totalDays * dayWidth;
            timeline.style.width = `${timelineWidth}px`;
            
            // Add scale markers
            let currentDate = new Date(timelineStartDate);
            while (currentDate <= timelineEndDate) {
                const dayPosition = ((currentDate - timelineStartDate) / (1000 * 60 * 60 * 24)) * dayWidth;
                
                const marker = document.createElement('div');
                marker.className = 'timeline-marker';
                marker.style.left = `${dayPosition}px`;
                
                const dateLabel = document.createElement('div');
                dateLabel.className = 'timeline-date';
                dateLabel.style.left = `${dayPosition}px`;
                
                // Get week number
                const weekNumber = getWeekNumber(currentDate);
                
                // Adjust date label based on zoom level
                if (currentZoom === 'day' || 
                    (currentZoom === 'week' && currentDate.getDay() === 1) ||
                    (currentZoom === 'month' && currentDate.getDate() === 1)) {
                    
                    if (currentZoom === 'week') {
                        dateLabel.textContent = `Week ${weekNumber}`;
                    } else {
                        dateLabel.textContent = new Intl.DateTimeFormat('en-US', {
                            month: 'short',
                            day: 'numeric'
                        }).format(currentDate);
                    }
                    timelineScale.appendChild(dateLabel);
                }
                
                timelineScale.appendChild(marker);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Add events to timeline
            courses.forEach(course => {
                const sessions = course.sessions.split(',').map(s => s.trim());
                sessions.forEach(session => {
                    const sessionDate = new Date(session);
                    if (sessionDate >= timelineStartDate && sessionDate <= timelineEndDate) {
                        const eventPosition = ((sessionDate - timelineStartDate) / (1000 * 60 * 60 * 24)) * dayWidth;
                        
                        const event = document.createElement('div');
                        event.className = 'timeline-event';
                        event.style.left = `${eventPosition}px`;
                        event.style.backgroundColor = `${course.color}40`;
                        event.style.borderLeft = `3px solid ${course.color}`;
                        event.innerHTML = `${course.emoji} ${course.name}<br>${course.time}`;
                        
                        // Add tooltip with full information
                        event.title = `${course.name}\n${course.code}\n${course.time}`;
                        
                        timelineEvents.appendChild(event);
                    }
                });
            });
        }

        // Theme management
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            // Update toggle button icon
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.textContent = theme === 'dark' ? '🌙' : '☀️';
            
            // Update button title
            themeToggle.title = theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
        }
        
        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        // Assignment management
        let assignments = [];
        let currentFilter = 'all';

        function initAssignments() {
            // Load assignments from localStorage
            const savedAssignments = localStorage.getItem('assignments');
            if (savedAssignments) {
                assignments = JSON.parse(savedAssignments);
            }
            
            // Request notification permission
            if ("Notification" in window) {
                Notification.requestPermission();
            }
            
            renderAssignments();
            setupAssignmentNotifications();
        }

        function renderAssignments() {
            const grid = document.getElementById('assignmentGrid');
            grid.innerHTML = '';
            
            const filteredAssignments = currentFilter === 'all' 
                ? assignments 
                : assignments.filter(a => a.status === currentFilter);
            
            filteredAssignments.forEach(assignment => {
                const card = createAssignmentCard(assignment);
                grid.appendChild(card);
            });
        }

        function createAssignmentCard(assignment) {
            const card = document.createElement('div');
            card.className = `assignment-card ${assignment.status}`;
            
            const deadline = new Date(assignment.deadline);
            const timeLeft = deadline - new Date();
            const daysLeft = Math.ceil(timeLeft / (1000 * 60 * 60 * 24));
            
            const course = courses.find(c => c.id === assignment.courseId);
            const courseEmoji = course ? course.emoji : '📚';
            
            card.innerHTML = `
                <div class="assignment-title">${assignment.title}</div>
                <div class="assignment-course">${courseEmoji} ${course ? course.name : 'Unknown Course'}</div>
                <div class="assignment-deadline">
                    Due: ${deadline.toLocaleDateString()} ${deadline.toLocaleTimeString()}
                </div>
                <div class="countdown">
                    ${daysLeft > 0 ? `${daysLeft} days remaining` : 'Past due'}
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${assignment.progress}%"></div>
                </div>
                <div class="assignment-actions">
                    <span class="status-badge ${assignment.status}">
                        ${assignment.status.replace('-', ' ').toUpperCase()}
                    </span>
                    <div>
                        <button class="btn btn-warning btn-sm edit-assignment" data-id="${assignment.id}">Edit</button>
                        <button class="btn btn-danger btn-sm delete-assignment" data-id="${assignment.id}">Delete</button>
                    </div>
                </div>
            `;
            
            // Add event listeners
            card.querySelector('.edit-assignment').addEventListener('click', () => {
                openEditAssignmentModal(assignment.id);
            });
            
            card.querySelector('.delete-assignment').addEventListener('click', () => {
                deleteAssignment(assignment.id);
            });
            
            return card;
        }

        function setupAssignmentNotifications() {
            // Check for upcoming assignments every minute
            setInterval(() => {
                const now = new Date();
                assignments.forEach(assignment => {
                    const deadline = new Date(assignment.deadline);
                    const timeLeft = deadline - now;
                    
                    // Notify 24 hours and 1 hour before deadline
                    if (assignment.status !== 'completed') {
                        if (timeLeft > 0 && timeLeft <= 60 * 60 * 1000) { // 1 hour
                            notifyAssignment(assignment, '1 hour');
                        } else if (timeLeft > 0 && timeLeft <= 24 * 60 * 60 * 1000) { // 24 hours
                            notifyAssignment(assignment, '24 hours');
                        }
                    }
                });
            }, 60000); // Check every minute
        }

        function notifyAssignment(assignment, timeLeft) {
            if (Notification.permission === "granted") {
                const course = courses.find(c => c.id === assignment.courseId);
                new Notification(`Assignment Due in ${timeLeft}`, {
                    body: `${assignment.title} for ${course ? course.name : 'Unknown Course'} is due soon!`,
                    icon: '/favicon.ico'
                });
            }
        }

        function openAddAssignmentModal() {
            const modal = document.getElementById('assignmentModal');
            const form = document.getElementById('assignmentForm');
            const courseSelect = document.getElementById('assignmentCourse');
            
            // Reset form
            form.reset();
            document.getElementById('assignmentId').value = '';
            document.getElementById('assignmentModalTitle').textContent = 'Add New Assignment';
            
            // Populate course options
            courseSelect.innerHTML = courses.map(course => 
                `<option value="${course.id}">${course.emoji} ${course.name}</option>`
            ).join('');
            
            modal.style.display = 'block';
        }

        function openEditAssignmentModal(assignmentId) {
            const assignment = assignments.find(a => a.id === assignmentId);
            if (!assignment) return;
            
            const modal = document.getElementById('assignmentModal');
            const form = document.getElementById('assignmentForm');
            
            document.getElementById('assignmentModalTitle').textContent = 'Edit Assignment';
            document.getElementById('assignmentId').value = assignment.id;
            document.getElementById('assignmentTitle').value = assignment.title;
            document.getElementById('assignmentCourse').value = assignment.courseId;
            document.getElementById('assignmentDescription').value = assignment.description;
            document.getElementById('assignmentDeadline').value = assignment.deadline.slice(0, 16);
            document.getElementById('assignmentProgress').value = assignment.progress;
            document.getElementById('assignmentStatus').value = assignment.status;
            
            modal.style.display = 'block';
        }

        function saveAssignment(e) {
            e.preventDefault();
            
            const assignmentId = document.getElementById('assignmentId').value;
            const newAssignment = {
                title: document.getElementById('assignmentTitle').value,
                courseId: parseInt(document.getElementById('assignmentCourse').value),
                description: document.getElementById('assignmentDescription').value,
                deadline: document.getElementById('assignmentDeadline').value,
                progress: parseInt(document.getElementById('assignmentProgress').value),
                status: document.getElementById('assignmentStatus').value
            };
            
            if (assignmentId) {
                // Update existing assignment
                const index = assignments.findIndex(a => a.id === parseInt(assignmentId));
                if (index !== -1) {
                    assignments[index] = { ...assignments[index], ...newAssignment, id: parseInt(assignmentId) };
                }
            } else {
                // Add new assignment
                const maxId = assignments.length > 0 ? Math.max(...assignments.map(a => a.id)) : 0;
                assignments.push({ ...newAssignment, id: maxId + 1 });
            }
            
            // Save to localStorage
            localStorage.setItem('assignments', JSON.stringify(assignments));
            
            // Close modal and refresh view
            document.getElementById('assignmentModal').style.display = 'none';
            renderAssignments();
        }

        function deleteAssignment(assignmentId) {
            if (confirm('Are you sure you want to delete this assignment?')) {
                assignments = assignments.filter(a => a.id !== assignmentId);
                localStorage.setItem('assignments', JSON.stringify(assignments));
                renderAssignments();
            }
        }

        // Add this to your setupEventListeners function
        function setupEventListeners() {
            addCourseBtn.addEventListener('click', openAddCourseModal);
            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', () => {
                courseModal.style.display = 'none';
            });
            courseForm.addEventListener('submit', saveCourse);
            
            // Close modal when clicking outside of it
            window.addEventListener('click', (e) => {
                if (e.target === courseModal) {
                    courseModal.style.display = 'none';
                }
            });
            
            // Add PDF export functionality
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', () => {
                    const element = document.querySelector('.container');
                    const opt = {
                        margin: 1,
                        filename: 'academic-schedule.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2 },
                        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                    };
                    
                    // Remove action buttons before generating PDF
                    const actionButtons = element.querySelectorAll('.action-buttons');
                    actionButtons.forEach(btn => btn.style.display = 'none');
                    
                    // Generate PDF
                    html2pdf().set(opt).from(element).save().then(() => {
                        // Restore action buttons after PDF generation
                        actionButtons.forEach(btn => btn.style.display = 'flex');
                    });
                });
            }
            
            // Timeline zoom controls
            document.querySelectorAll('.zoom-level').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.zoom-level').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    currentZoom = e.target.dataset.zoom;
                    renderTimeline();
                });
            });
            
            // Timeline navigation
            document.getElementById('prevTimeline').addEventListener('click', () => {
                const monthDiff = currentZoom === 'month' ? 1 : (currentZoom === 'week' ? 0.25 : 0.1);
                timelineStartDate.setMonth(timelineStartDate.getMonth() - monthDiff);
                timelineEndDate.setMonth(timelineEndDate.getMonth() - monthDiff);
                renderTimeline();
            });
            
            document.getElementById('nextTimeline').addEventListener('click', () => {
                const monthDiff = currentZoom === 'month' ? 1 : (currentZoom === 'week' ? 0.25 : 0.1);
                timelineStartDate.setMonth(timelineStartDate.getMonth() + monthDiff);
                timelineEndDate.setMonth(timelineEndDate.getMonth() + monthDiff);
                renderTimeline();
            });
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Assignment event listeners
            document.getElementById('addAssignmentBtn').addEventListener('click', openAddAssignmentModal);
            document.getElementById('assignmentForm').addEventListener('submit', saveAssignment);
            document.getElementById('cancelAssignmentBtn').addEventListener('click', () => {
                document.getElementById('assignmentModal').style.display = 'none';
            });
            
            // Assignment filters
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.filter;
                    renderAssignments();
                });
            });

            // Event delegation for course table actions
            courseTable.addEventListener('click', function(e) {
                const target = e.target;
                
                // Handle edit button clicks
                if (target.classList.contains('edit-course')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const courseId = parseInt(target.getAttribute('data-id'));
                    console.log('Edit button clicked for course:', courseId); // Debug log
                    openEditCourseModal(courseId);
                }
                
                // Handle delete button clicks
                if (target.classList.contains('delete-course')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const courseId = parseInt(target.getAttribute('data-id'));
                    console.log('Delete button clicked for course:', courseId); // Debug log
                    deleteCourse(courseId);
                }
            });
        }
        
        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>